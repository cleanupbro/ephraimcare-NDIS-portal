---
phase: 04-shift-scheduling
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - packages/ui/src/components/sheet.tsx
  - packages/ui/src/index.ts
  - apps/admin/hooks/use-shifts.ts
  - apps/admin/components/shifts/shift-card.tsx
  - apps/admin/components/shifts/shift-week-nav.tsx
  - apps/admin/components/shifts/shift-list.tsx
  - apps/admin/app/(protected)/shifts/page.tsx
autonomous: true

must_haves:
  truths:
    - "Shift list page shows shifts grouped by day within the current week"
    - "Each shift card displays time range, participant, worker, support type, and status with color coding"
    - "Week navigation allows moving forward/backward and jumping to today"
    - "Empty weeks show an appropriate empty state message"
  artifacts:
    - path: "packages/ui/src/components/sheet.tsx"
      provides: "Reusable Sheet (side panel) component"
      exports: ["Sheet", "SheetTrigger", "SheetContent", "SheetHeader", "SheetTitle", "SheetDescription", "SheetClose"]
    - path: "apps/admin/hooks/use-shifts.ts"
      provides: "TanStack Query hook for fetching shifts by week"
      exports: ["useShifts"]
    - path: "apps/admin/components/shifts/shift-list.tsx"
      provides: "Client list component with week nav, grouped cards"
      exports: ["ShiftList"]
    - path: "apps/admin/components/shifts/shift-card.tsx"
      provides: "Individual shift card with status border and badge"
      exports: ["ShiftCard"]
    - path: "apps/admin/components/shifts/shift-week-nav.tsx"
      provides: "Week forward/back/today navigation"
      exports: ["ShiftWeekNav"]
    - path: "apps/admin/app/(protected)/shifts/page.tsx"
      provides: "Server page with initial data fetch"
      min_lines: 20
  key_links:
    - from: "apps/admin/app/(protected)/shifts/page.tsx"
      to: "apps/admin/components/shifts/shift-list.tsx"
      via: "passes initialData prop"
      pattern: "initialData"
    - from: "apps/admin/components/shifts/shift-list.tsx"
      to: "apps/admin/hooks/use-shifts.ts"
      via: "useShifts hook for reactive data"
      pattern: "useShifts"
    - from: "apps/admin/components/shifts/shift-card.tsx"
      to: "apps/admin/lib/shifts/constants.ts"
      via: "imports SHIFT_STATUS_COLORS for styling"
      pattern: "SHIFT_STATUS_COLORS"
---

<objective>
Build the shift list page with week navigation and day-grouped shift cards, plus the reusable Sheet component.

Purpose: Deliver the primary shift viewing experience where admin sees all shifts for a given week grouped by day, with visual status indicators. The Sheet component is a new UI pattern needed for shift detail (Plan 04) and future entity quick-views.

Output: Functional shift list page replacing the placeholder, Sheet in UI package, shift query hook.
</objective>

<execution_context>
@/Users/shamalkrishna/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shamalkrishna/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-shift-scheduling/04-RESEARCH.md
@.planning/phases/04-shift-scheduling/04-01-SUMMARY.md
@apps/admin/components/participants/participant-list.tsx
@apps/admin/hooks/use-participants.ts
@packages/ui/src/components/dialog.tsx
@packages/ui/src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Sheet UI component in packages/ui</name>
  <files>packages/ui/src/components/sheet.tsx, packages/ui/src/index.ts</files>
  <action>
Create `packages/ui/src/components/sheet.tsx` following the established shadcn/ui pattern (forwardRef + cn + Radix primitives). Use `@radix-ui/react-dialog` (already installed) with custom styling for a slide-from-right panel:

- Sheet (root): Re-export Dialog.Root
- SheetTrigger: Re-export Dialog.Trigger
- SheetClose: Re-export Dialog.Close
- SheetPortal: Dialog.Portal
- SheetOverlay: Dialog.Overlay with fixed inset-0, bg-black/80, fade animation
- SheetContent: Dialog.Content with:
  - Fixed positioning: `fixed inset-y-0 right-0 z-50`
  - Width: `w-3/4 sm:max-w-md` (responsive)
  - Background: `bg-background`
  - Border: `border-l`
  - Shadow: `shadow-lg`
  - Animation: slide in from right using `data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right`
  - Close button (X icon) in top-right corner
  - Overflow-y-auto for scrollable content
- SheetHeader: div with `flex flex-col space-y-2 px-6 pt-6`
- SheetTitle: Dialog.Title with heading styles
- SheetDescription: Dialog.Description with muted text
- SheetFooter: div with `flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 px-6 pb-6`

Export all components from `packages/ui/src/index.ts` (add exports at the bottom with other component exports).

Note: This uses the same @radix-ui/react-dialog already used for Dialog/AlertDialog but with different positioning (side panel vs centered modal).
  </action>
  <verify>Check sheet.tsx exists with Sheet, SheetContent, SheetTrigger exports. Check index.ts exports them. Run `pnpm --filter @ephraimcare/ui tsc --noEmit` to verify no type errors.</verify>
  <done>Sheet component is available from @ephraimcare/ui for use in shift detail sheet and future side panels.</done>
</task>

<task type="auto">
  <name>Task 2: useShifts hook and ShiftCard component</name>
  <files>apps/admin/hooks/use-shifts.ts, apps/admin/components/shifts/shift-card.tsx</files>
  <action>
Create `apps/admin/hooks/use-shifts.ts`:
- Accept options: `{ weekStart: string, weekEnd: string }` (ISO date strings)
- Use `useQuery` with queryKey: `['shifts', { weekStart, weekEnd }]`
- Query: supabase.from('shifts').select('*, participants(id, first_name, last_name), workers(id, services_provided, profiles(first_name, last_name))') filtered by scheduled_start between weekStart and weekEnd, ordered by scheduled_start ascending
- Use `(as any)` type assertion on the query result (established pattern for PostgREST joins)
- Return type: ShiftWithRelations[] (from packages/types)
- staleTime: 30_000 (match existing hooks)
- Accept optional `initialData` parameter for SSR hydration

Create `apps/admin/components/shifts/shift-card.tsx`:
- 'use client' directive
- Accept props: `{ shift: ShiftWithRelations, onClick?: () => void }`
- Render a card with:
  - Left border color from SHIFT_STATUS_COLORS[shift.status].border (4px thick: `border-l-4`)
  - Time range: format scheduled_start and scheduled_end with `formatSydneyDate` or inline toLocaleString (HH:mm format, Sydney timezone)
  - Participant name: `shift.participants?.first_name shift.participants?.last_name`
  - Worker name: `shift.workers?.profiles?.first_name shift.workers?.profiles?.last_name`
  - Support type: displayed as small text
  - Status badge: span with SHIFT_STATUS_COLORS[shift.status].badge classes and .text label
  - Duration: calculate from scheduled_start/end, display as "Xh" or "Xh Ym"
- Cursor pointer on hover if onClick provided
- Layout: compact horizontal card (time | names | status) or small vertical card -- use judgment for readability
  </action>
  <verify>Check both files exist. Verify use-shifts.ts exports useShifts function. Verify shift-card.tsx imports SHIFT_STATUS_COLORS and renders status badge.</verify>
  <done>Query hook fetches shifts for a given week. Card component renders individual shift with dual status indicator (border + badge).</done>
</task>

<task type="auto">
  <name>Task 3: Week navigation, list component, and page replacement</name>
  <files>apps/admin/components/shifts/shift-week-nav.tsx, apps/admin/components/shifts/shift-list.tsx, apps/admin/app/(protected)/shifts/page.tsx</files>
  <action>
Create `apps/admin/components/shifts/shift-week-nav.tsx`:
- 'use client' directive
- Accept props: `{ currentWeekStart: Date, onPrev: () => void, onNext: () => void, onToday: () => void }`
- Display: formatted week range (e.g., "20 Jan - 26 Jan 2026")
- Buttons: ChevronLeft (prev), ChevronRight (next), "Today" text button
- Use `format` from date-fns for display
- Compact horizontal layout with flex

Create `apps/admin/components/shifts/shift-list.tsx`:
- 'use client' directive
- Accept props: `{ initialData: ShiftWithRelations[] }`
- State: `weekStart` (Date, default to startOfISOWeek(new Date()))
- Derive `weekEnd` from weekStart using endOfISOWeek
- Use `useShifts` hook with weekStart/weekEnd ISO strings and initialData
- Week navigation: use addWeeks/subWeeks from date-fns, "today" resets to current week's start
- Group shifts by day: use `format(shift.scheduled_start, 'yyyy-MM-dd')` as key, group into a Map/Object
- Render each day with:
  - Day header: format as "Monday, 20 Jan" (only for days that have shifts)
  - Cards: map over shifts for that day, render ShiftCard for each
- Handle loading state with Skeleton components
- Handle empty state: "No shifts scheduled this week" message with a subtle illustration or icon
- Include a Link button "Schedule Shift" pointing to `/shifts/new` (top-right, uses Button from @ephraimcare/ui)
- Filter out cancelled shifts by default (hardcode for now -- Plan 04 adds filter controls)

Replace `apps/admin/app/(protected)/shifts/page.tsx`:
- Server component (no 'use client')
- Create Supabase server client
- Fetch current week's shifts (startOfISOWeek to endOfISOWeek of today) with same select join as useShifts
- Pass as initialData to ShiftList component
- Minimal layout wrapper (same pattern as participants/page.tsx)
  </action>
  <verify>Navigate to /shifts in the browser (or check that page.tsx renders without errors via `pnpm --filter admin build` or dev server). Verify shifts are grouped by day. Verify week navigation arrows change the displayed week.</verify>
  <done>Shift list page shows shifts grouped by day with week navigation. Cards display participant, worker, time, and status. Empty weeks show appropriate message. "Schedule Shift" button links to create form.</done>
</task>

</tasks>

<verification>
1. Sheet component exports are available from @ephraimcare/ui
2. /shifts page loads with server-side data and transitions to client-side TanStack Query
3. Shifts are visually grouped by day within the current week
4. Each card shows colored left border AND status badge (dual indicator)
5. Week nav arrows change the displayed week and refetch data
6. "Today" button jumps back to current week
7. Empty state displays when no shifts exist for a week
8. "Schedule Shift" button links to /shifts/new
9. Cancelled shifts are hidden from the default view
</verification>

<success_criteria>
- Admin sees shifts organized by day for the current week on page load
- Status colors match the defined SHIFT_STATUS_COLORS (border + badge)
- Week navigation is responsive and fetches correct data for each week
- Sheet component is reusable and available from the UI package
- Page follows established SSR + client hydration pattern
</success_criteria>

<output>
After completion, create `.planning/phases/04-shift-scheduling/04-02-SUMMARY.md`
</output>
