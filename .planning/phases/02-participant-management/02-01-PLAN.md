---
phase: 02-participant-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/admin/package.json
  - packages/ui/src/components/table.tsx
  - packages/ui/src/components/input.tsx
  - packages/ui/src/components/badge.tsx
  - packages/ui/src/components/progress.tsx
  - packages/ui/src/components/card.tsx
  - packages/ui/src/components/dialog.tsx
  - packages/ui/src/components/alert-dialog.tsx
  - packages/ui/src/components/tabs.tsx
  - packages/ui/src/components/select.tsx
  - packages/ui/src/components/label.tsx
  - packages/ui/src/components/textarea.tsx
  - packages/ui/src/components/separator.tsx
  - packages/ui/src/components/skeleton.tsx
  - packages/ui/src/components/dropdown-menu.tsx
  - packages/ui/src/index.ts
  - apps/admin/lib/participants/schemas.ts
  - apps/admin/components/ui/data-table.tsx
autonomous: true

must_haves:
  truths:
    - "Zod schemas validate each form step independently with correct constraints"
    - "DataTable component renders columns, supports sorting, pagination, and empty state"
    - "@tanstack/react-table is installed and importable in admin app"
    - "All required shadcn/ui components are available in packages/ui"
  artifacts:
    - path: "apps/admin/lib/participants/schemas.ts"
      provides: "Step-level Zod schemas + full participant schema"
      exports: ["basicInfoSchema", "planDetailsSchema", "contactsSchema", "supportNeedsSchema", "participantFullSchema", "BasicInfoData", "PlanDetailsData", "ContactsData", "SupportNeedsData"]
    - path: "apps/admin/components/ui/data-table.tsx"
      provides: "Generic reusable DataTable component"
      exports: ["DataTable"]
  key_links:
    - from: "apps/admin/lib/participants/schemas.ts"
      to: "zod"
      via: "z.object() schema definitions"
      pattern: "z\\.object"
    - from: "apps/admin/components/ui/data-table.tsx"
      to: "@tanstack/react-table"
      via: "useReactTable hook"
      pattern: "useReactTable"
---

<objective>
Install dependencies, create participant Zod validation schemas, and build a reusable DataTable component that will be used across this phase and future phases (workers, shifts).

Purpose: Provides the shared foundation (schemas + table component + UI primitives) that all subsequent participant management plans depend on.
Output: Installable schemas, functional DataTable component, and all shadcn/ui components needed for the phase.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-participant-management/02-RESEARCH.md

@packages/types/src/domain.ts
@packages/utils/src/validators.ts
@apps/admin/package.json
@packages/ui/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @tanstack/react-table and shadcn/ui components</name>
  <files>
    apps/admin/package.json
    packages/ui/src/components/table.tsx
    packages/ui/src/components/input.tsx
    packages/ui/src/components/badge.tsx
    packages/ui/src/components/progress.tsx
    packages/ui/src/components/card.tsx
    packages/ui/src/components/dialog.tsx
    packages/ui/src/components/alert-dialog.tsx
    packages/ui/src/components/tabs.tsx
    packages/ui/src/components/select.tsx
    packages/ui/src/components/label.tsx
    packages/ui/src/components/textarea.tsx
    packages/ui/src/components/separator.tsx
    packages/ui/src/components/skeleton.tsx
    packages/ui/src/components/dropdown-menu.tsx
    packages/ui/src/index.ts
  </files>
  <action>
    1. In apps/admin, install @tanstack/react-table:
       `pnpm add @tanstack/react-table`

    2. In packages/ui directory, install all required shadcn/ui components using the shadcn CLI:
       `npx shadcn@latest add table input badge progress card dialog alert-dialog tabs select label textarea separator skeleton dropdown-menu`

       If shadcn CLI doesn't work in the packages/ui directory (due to monorepo), create the component files manually following shadcn/ui patterns. Each component should:
       - Use "use client" directive
       - Import from class-variance-authority where needed
       - Use cn() utility for class merging
       - Export named components matching shadcn/ui API

    3. Ensure packages/ui/src/index.ts re-exports all new components so they're importable as `@ephraimcare/ui/components/table` etc.

    Note: Some components like button and toast may already exist from Phase 1. Skip those if already present. Only add what's missing.
  </action>
  <verify>
    Run `pnpm typecheck` from monorepo root. No type errors.
    Verify @tanstack/react-table appears in apps/admin/package.json dependencies.
    Verify at least table.tsx, badge.tsx, progress.tsx exist in packages/ui/src/components/.
  </verify>
  <done>All shadcn/ui components needed for Phase 2 exist and are importable. @tanstack/react-table is installed in admin app.</done>
</task>

<task type="auto">
  <name>Task 2: Create step-level Zod schemas for participant form</name>
  <files>apps/admin/lib/participants/schemas.ts</files>
  <action>
    Create `apps/admin/lib/participants/schemas.ts` with 4 step-level schemas + 1 full schema:

    **Step 1 - basicInfoSchema:**
    - first_name: string, min 1, max 100
    - last_name: string, min 1, max 100
    - ndis_number: string, regex /^\d{9}$/ (9 digits), refine startsWith('43')
    - date_of_birth: string, min 1 required, refine must be in past and after 1900-01-01
    - phone: string, regex /^(\+61|0)[2-9]\d{8}$/ (Australian format), optional or empty string
    - email: string.email(), optional or empty string

    **Step 2 - planDetailsSchema:**
    - plan_number: string, optional
    - plan_start_date: string, min 1 required
    - plan_end_date: string, min 1 required
    - total_budget: z.coerce.number(), min 0, max 999999.99
    - budget_categories: optional array of { category: string min 1, allocated_amount: z.coerce.number() min 0 }
    - .refine: plan_end_date must be after plan_start_date

    **Step 3 - contactsSchema:**
    - address_line_1: string optional
    - address_line_2: string optional
    - suburb: string optional
    - state: string default 'NSW'
    - postcode: string regex /^\d{4}$/ optional or empty
    - emergency_contact_name: string optional
    - emergency_contact_phone: string regex Australian format, optional or empty

    **Step 4 - supportNeedsSchema:**
    - notes: string max 2000, optional

    **Full schema - participantFullSchema:**
    - Merge of basicInfoSchema + contactsSchema + supportNeedsSchema (for edit form, excludes plan details which are separate entity)

    Export all schemas AND their inferred types (BasicInfoData, PlanDetailsData, ContactsData, SupportNeedsData).

    IMPORTANT: Do NOT duplicate the existing participantSchema in packages/utils/src/validators.ts. That schema remains for basic server-side validation. The new schemas here are specifically for the multi-step form with stricter validation rules (date logic, NDIS format with startsWith check, etc.).
  </action>
  <verify>
    Create a quick test: import the schemas and validate sample data:
    - basicInfoSchema.parse({ first_name: 'John', last_name: 'Doe', ndis_number: '430000001', date_of_birth: '1990-01-01' }) should succeed
    - basicInfoSchema.parse({ ndis_number: '123' }) should throw
    - planDetailsSchema with end_date before start_date should throw
    Run `pnpm typecheck` from monorepo root.
  </verify>
  <done>All 4 step schemas + full schema exist, validate correctly, and export inferred TypeScript types.</done>
</task>

<task type="auto">
  <name>Task 3: Create reusable DataTable component</name>
  <files>apps/admin/components/ui/data-table.tsx</files>
  <action>
    Create `apps/admin/components/ui/data-table.tsx` - a generic, reusable data table component built on @tanstack/react-table + shadcn/ui Table.

    Component: `DataTable<TData, TValue>`

    Props:
    - columns: ColumnDef<TData, TValue>[]
    - data: TData[]
    - pageSize?: number (default 10)

    Features:
    - Sorting (client-side, via getSortedRowModel)
    - Pagination (client-side, via getPaginationRowModel, with Previous/Next buttons + page info)
    - Empty state ("No results." centered in table body)
    - Uses shadcn/ui Table, TableBody, TableCell, TableHead, TableHeader, TableRow from @ephraimcare/ui

    State:
    - sorting: SortingState
    - pagination state (managed by TanStack Table)

    Implementation:
    - "use client" directive
    - Import from @tanstack/react-table: ColumnDef, SortingState, flexRender, getCoreRowModel, getPaginationRowModel, getSortedRowModel, useReactTable
    - Import Table components from @ephraimcare/ui (or relative path if package re-exports aren't set up yet)
    - Import Button from @ephraimcare/ui

    The component should be generic enough to reuse for workers and shifts tables in future phases. Do NOT include participant-specific logic here.

    If @ephraimcare/ui imports don't resolve, use relative imports from packages/ui/src/components/ via the workspace package.
  </action>
  <verify>
    Run `pnpm typecheck` from monorepo root. DataTable component has no type errors.
    The component file uses proper generics (DataTable<TData, TValue>).
    The component exports the DataTable function.
  </verify>
  <done>DataTable component exists, is type-safe with generics, supports sorting + pagination + empty state, and is reusable across entity types.</done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes from monorepo root
2. @tanstack/react-table is in apps/admin/package.json dependencies
3. apps/admin/lib/participants/schemas.ts exports 5 schemas + 4 types
4. apps/admin/components/ui/data-table.tsx exports DataTable component
5. shadcn/ui components exist in packages/ui/src/components/
</verification>

<success_criteria>
- TypeScript compilation succeeds across the monorepo
- All schemas correctly validate and reject test cases
- DataTable renders without errors when given sample columns + data
- No import resolution errors for @tanstack/react-table or UI components
</success_criteria>

<output>
After completion, create `.planning/phases/02-participant-management/02-01-SUMMARY.md`
</output>
