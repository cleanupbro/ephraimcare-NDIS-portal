---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - pnpm-workspace.yaml
  - .npmrc
  - turbo.json
  - .gitignore
  - .env.example
  - apps/admin/package.json
  - apps/admin/next.config.ts
  - apps/admin/tsconfig.json
  - apps/admin/postcss.config.js
  - apps/participant/package.json
  - apps/participant/next.config.ts
  - apps/participant/tsconfig.json
  - apps/participant/postcss.config.js
  - apps/worker-mobile/package.json
  - apps/worker-mobile/app.json
  - apps/worker-mobile/metro.config.js
  - apps/worker-mobile/tsconfig.json
autonomous: true

must_haves:
  truths:
    - "Running pnpm install from root resolves all workspace dependencies"
    - "turbo run build completes for all packages without error"
    - "The monorepo has 3 apps and 5 packages in the workspace"
  artifacts:
    - path: "package.json"
      provides: "Root package.json with scripts"
      contains: "turbo run dev"
    - path: "pnpm-workspace.yaml"
      provides: "Workspace definition"
      contains: "apps/*"
    - path: "turbo.json"
      provides: "Task orchestration"
      contains: "tasks"
    - path: ".npmrc"
      provides: "pnpm config for Expo compatibility"
      contains: "node-linker=hoisted"
  key_links:
    - from: "pnpm-workspace.yaml"
      to: "apps/*/package.json"
      via: "workspace protocol"
      pattern: "packages:"
    - from: "turbo.json"
      to: "apps/*/package.json"
      via: "task matching"
      pattern: "\"dev\""
---

<objective>
Scaffold the Turborepo + pnpm monorepo with all three apps (admin, participant, worker-mobile) and workspace structure for five packages. Create root configuration files and minimal app entry points so that `pnpm install` and `turbo run build` succeed.

Purpose: Every subsequent plan depends on this monorepo structure existing. This is the skeleton that everything else hangs on.
Output: A working monorepo where `pnpm install` resolves all workspace references and Turborepo can orchestrate tasks.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create root monorepo configuration</name>
  <files>
    package.json
    pnpm-workspace.yaml
    .npmrc
    turbo.json
    .gitignore
    .env.example
  </files>
  <action>
    Create the root monorepo configuration files:

    1. **package.json** - Root package.json with:
       - name: "ephraimcare-portal"
       - private: true
       - scripts: dev, build, lint, test, test:e2e, db:generate-types, db:reset, db:migrate, db:seed
       - devDependencies: turbo (^2.4), typescript (^5.7), @types/node (^22)
       - pnpm overrides for React 19: react "^19.0.0", react-dom "^19.0.0"

    2. **pnpm-workspace.yaml** - Define workspaces:
       - 'apps/*'
       - 'packages/*'
       - 'supabase'

    3. **.npmrc** - pnpm config for Expo compatibility:
       - node-linker=hoisted
       - shamefully-hoist=true

    4. **turbo.json** - Task definitions (use the $schema from turborepo.com/schema.json):
       - build: dependsOn ^build, outputs .next/**, dist/**
       - dev: cache false, persistent true
       - lint: dependsOn ^build
       - test: dependsOn ^build, outputs coverage/**
       - test:e2e: dependsOn build, outputs playwright-report/**
       - generate: cache false
       - globalEnv: NEXT_PUBLIC_SUPABASE_URL, NEXT_PUBLIC_SUPABASE_ANON_KEY

    5. **.gitignore** - Standard monorepo ignores:
       - node_modules, .next, dist, .turbo, .env*, coverage, playwright-report
       - Expo: .expo, ios, android
       - Supabase: .branches, .temp

    6. **.env.example** - Template with all required env vars:
       - NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
       - NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
       - SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
  </action>
  <verify>
    - All 6 files exist at root
    - package.json is valid JSON (node -e "require('./package.json')")
    - turbo.json is valid JSON
  </verify>
  <done>Root monorepo configuration files exist and are valid</done>
</task>

<task type="auto">
  <name>Task 2: Create app scaffolds (admin, participant, worker-mobile)</name>
  <files>
    apps/admin/package.json
    apps/admin/next.config.ts
    apps/admin/tsconfig.json
    apps/admin/postcss.config.js
    apps/admin/app/layout.tsx
    apps/admin/app/page.tsx
    apps/participant/package.json
    apps/participant/next.config.ts
    apps/participant/tsconfig.json
    apps/participant/postcss.config.js
    apps/participant/app/layout.tsx
    apps/participant/app/page.tsx
    apps/worker-mobile/package.json
    apps/worker-mobile/app.json
    apps/worker-mobile/metro.config.js
    apps/worker-mobile/tsconfig.json
    apps/worker-mobile/app/_layout.tsx
    apps/worker-mobile/app/index.tsx
  </files>
  <action>
    Create minimal but complete app scaffolds:

    **apps/admin:**
    - package.json: name "@ephraimcare/admin", dependencies (next@15.5, react@19, react-dom@19, @supabase/supabase-js, @supabase/ssr), devDeps (typescript, @types/react, @types/node, tailwindcss@4, @tailwindcss/postcss, postcss), scripts (dev --port 3000, build, start, lint, test, test:e2e)
    - next.config.ts: transpilePackages for @ephraimcare/* packages
    - tsconfig.json: extend from base (create inline, target ES2022, jsx preserve, module bundler, moduleResolution bundler, paths with @ alias)
    - postcss.config.js: @tailwindcss/postcss plugin
    - app/layout.tsx: Root layout with html/body, import globals.css placeholder
    - app/page.tsx: Simple "Ephraim Care Admin" heading (proves app renders)

    **apps/participant:**
    - Same structure as admin but name "@ephraimcare/participant", port 3001
    - page.tsx: "Ephraim Care Participant Portal" heading

    **apps/worker-mobile:**
    - package.json: name "@ephraimcare/worker-mobile", dependencies (expo, expo-router, react@19, react-native, react-native-paper, @supabase/supabase-js), scripts (start, android, ios, web)
    - app.json: expo config with name "Ephraim Care Worker", slug "ephraimcare-worker", scheme "ephraimcare", plugins ["expo-router"]
    - metro.config.js: Minimal config using expo/metro-config (auto-detect monorepo)
    - tsconfig.json: extend expo tsconfig, include app/**/*.tsx
    - app/_layout.tsx: Root Stack layout with expo-router
    - app/index.tsx: Simple "Worker App" text component

    IMPORTANT: Do NOT add workspace protocol references (workspace:*) to app package.json files yet -- the packages don't exist yet. They will be added in Plan 02.
  </action>
  <verify>
    - All app directories exist with package.json files
    - Each app has at least layout + page/index entry point
    - node -e "require('./apps/admin/package.json')" succeeds for all 3 apps
  </verify>
  <done>Three apps scaffolded with valid configs and minimal entry points</done>
</task>

<task type="auto">
  <name>Task 3: Install dependencies and verify monorepo works</name>
  <files></files>
  <action>
    1. Run `pnpm install` from the monorepo root
    2. Verify workspace detection: `pnpm ls --depth=0` should show the workspace packages
    3. Run `pnpm turbo run build --dry-run` to verify Turborepo sees all apps/packages
    4. Initialize git: `git init && git add . && git commit -m "chore: scaffold monorepo with Turborepo + pnpm"`

    If pnpm install fails due to missing peer deps or resolution issues:
    - Check .npmrc has node-linker=hoisted
    - Verify pnpm overrides in root package.json pin React 19
    - Expo may need specific react/react-native versions -- adjust if needed

    Note: `pnpm dev` will NOT work yet (packages not created, no globals.css) -- that comes after Plan 02. The goal here is just that the workspace resolves and turbo sees the apps.
  </action>
  <verify>
    - `pnpm install` completes without error
    - `pnpm turbo run build --dry-run` shows admin, participant in the task graph
    - `git log --oneline` shows initial commit
  </verify>
  <done>Dependencies installed, Turborepo detects all workspaces, git initialized</done>
</task>

</tasks>

<verification>
- pnpm install succeeds from root
- turbo.json tasks are detected
- All 3 apps have valid package.json and entry points
- Git repo initialized with initial commit
</verification>

<success_criteria>
- Monorepo structure exists with apps/admin, apps/participant, apps/worker-mobile
- pnpm workspace resolves all dependencies
- Turborepo can detect and orchestrate across workspaces
- Git repository initialized
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
