---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - packages/types/package.json
  - packages/types/tsconfig.json
  - packages/types/src/index.ts
  - packages/types/src/roles.ts
  - packages/supabase/package.json
  - packages/supabase/tsconfig.json
  - packages/supabase/src/client.ts
  - packages/supabase/src/server.ts
  - packages/supabase/src/admin.ts
  - packages/supabase/src/middleware.ts
  - packages/supabase/src/session-monitor.ts
  - packages/supabase/src/index.ts
  - packages/utils/package.json
  - packages/utils/tsconfig.json
  - packages/utils/src/dates.ts
  - packages/utils/src/currency.ts
  - packages/utils/src/validators.ts
  - packages/utils/src/index.ts
  - packages/ui/package.json
  - packages/ui/tsconfig.json
  - packages/ui/src/styles/globals.css
  - packages/ui/src/lib/utils.ts
  - packages/ui/src/index.ts
  - packages/ui/components.json
  - packages/config/package.json
  - packages/config/typescript/base.json
autonomous: true

must_haves:
  truths:
    - "All workspace packages resolve and import correctly"
    - "Ephraim Care branding tokens are defined in globals.css"
    - "Supabase client/server/admin factory functions export correctly"
    - "Timezone helpers produce correct Australia/Sydney dates"
  artifacts:
    - path: "packages/ui/src/styles/globals.css"
      provides: "Tailwind CSS 4 theme with Ephraim Care brand tokens"
      contains: "--primary"
    - path: "packages/supabase/src/server.ts"
      provides: "Server-side Supabase client with cookie pattern"
      contains: "createServerClient"
    - path: "packages/supabase/src/middleware.ts"
      provides: "updateSession helper for Next.js middleware"
      contains: "getUser"
    - path: "packages/utils/src/dates.ts"
      provides: "Australia/Sydney timezone utilities"
      contains: "Australia/Sydney"
  key_links:
    - from: "packages/supabase/src/client.ts"
      to: "packages/types/src/index.ts"
      via: "Database type import"
      pattern: "@ephraimcare/types"
    - from: "packages/ui/src/styles/globals.css"
      to: "apps/admin/app/layout.tsx"
      via: "CSS import"
      pattern: "@ephraimcare/ui"
---

<objective>
Create all five shared packages (types, supabase, utils, ui, config) with their implementations. This establishes the shared foundation that all three apps consume: Supabase client factories, timezone utilities, branding theme, and TypeScript configuration.

Purpose: Apps need shared packages for auth, database access, styling, and utilities. Without these, no feature work can proceed.
Output: Five importable packages with complete implementations for auth, data access, theming, and utilities.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create packages/types, packages/config, and packages/utils</name>
  <files>
    packages/types/package.json
    packages/types/tsconfig.json
    packages/types/src/index.ts
    packages/types/src/roles.ts
    packages/types/src/database.ts
    packages/config/package.json
    packages/config/typescript/base.json
    packages/utils/package.json
    packages/utils/tsconfig.json
    packages/utils/src/dates.ts
    packages/utils/src/currency.ts
    packages/utils/src/validators.ts
    packages/utils/src/index.ts
  </files>
  <action>
    **packages/types:**
    - package.json: name "@ephraimcare/types", main "src/index.ts", types "src/index.ts", exports "./": "./src/index.ts"
    - src/roles.ts: Export AppRole type = 'admin' | 'coordinator' | 'worker' | 'participant'. Export ROLES constant array. Export role hierarchy helper (isAdminOrCoordinator, canAccessAdmin, etc.)
    - src/database.ts: Placeholder stub with `export type Database = any` comment "Generated by supabase gen types -- replaced after migrations"
    - src/index.ts: Re-export from roles.ts and database.ts

    **packages/config:**
    - package.json: name "@ephraimcare/config", private true
    - typescript/base.json: Shared tsconfig (target ES2022, module ESNext, moduleResolution bundler, strict, jsx react-jsx, esModuleInterop, skipLibCheck, forceConsistentCasingInFileNames, resolveJsonModule, isolatedModules, incremental)

    **packages/utils:**
    - package.json: name "@ephraimcare/utils", main "src/index.ts", types "src/index.ts", dependencies: date-fns@^4, @date-fns/tz@latest, zod@latest
    - tsconfig.json: extend from @ephraimcare/config/typescript/base.json
    - src/dates.ts: Implement timezone helpers (from research):
      - TIMEZONE = 'Australia/Sydney'
      - toSydneyTime(date): TZDate
      - formatSydneyDate(date, format): string
      - getCurrentSydneyTime(): TZDate
      - getTimezoneAbbreviation(date): 'AEST' | 'AEDT'
    - src/currency.ts: formatAUD(cents: number): string (format as $X,XXX.XX), parseCentsFromDollars(dollars: number): number
    - src/validators.ts: Zod schemas for common validation:
      - ndisNumberSchema: z.string().regex(/^\d{6,7}$/)
      - emailSchema: z.string().email()
      - phoneSchema: z.string() (Australian format)
      - dateRangeSchema: z.object({ from: z.date(), to: z.date() }).refine(d => d.to > d.from)
    - src/index.ts: Re-export all from dates, currency, validators
  </action>
  <verify>
    - All package.json files are valid JSON
    - TypeScript files have no syntax errors (npx tsc --noEmit in each package dir)
    - Zod schemas can be imported and used
  </verify>
  <done>types, config, and utils packages exist with complete implementations</done>
</task>

<task type="auto">
  <name>Task 2: Create packages/supabase and packages/ui</name>
  <files>
    packages/supabase/package.json
    packages/supabase/tsconfig.json
    packages/supabase/src/client.ts
    packages/supabase/src/server.ts
    packages/supabase/src/admin.ts
    packages/supabase/src/middleware.ts
    packages/supabase/src/session-monitor.ts
    packages/supabase/src/index.ts
    packages/ui/package.json
    packages/ui/tsconfig.json
    packages/ui/src/styles/globals.css
    packages/ui/src/lib/utils.ts
    packages/ui/src/components/footer.tsx
    packages/ui/src/index.ts
    packages/ui/components.json
  </files>
  <action>
    **packages/supabase:**
    - package.json: name "@ephraimcare/supabase", main "src/index.ts", deps: @supabase/supabase-js, @supabase/ssr, @ephraimcare/types (workspace:*)
    - src/client.ts: createClient() using createBrowserClient with Database type from @ephraimcare/types (exact pattern from research Pattern 1)
    - src/server.ts: createClient() using createServerClient with getAll/setAll cookie pattern (import cookies from next/headers). Mark with 'use server' if needed.
    - src/admin.ts: createAdminClient() using createClient from @supabase/supabase-js with SUPABASE_SERVICE_ROLE_KEY. Add comment "NEVER use in browser code"
    - src/middleware.ts: updateSession(request) function (exact pattern from research Pattern 1). Include role-based route protection logic:
      - Unauthenticated users redirected to /login for protected routes
      - Check JWT claims for user_role
      - Admin routes (/dashboard/*) require 'admin' or 'coordinator' role
      - Return 403 page for unauthorized role access
    - src/session-monitor.ts: createInactivityMonitor(onTimeout, timeoutMs = 8 * 60 * 60 * 1000) (exact pattern from research - AUTH-03). Monitors mousedown, keydown, scroll, touchstart events. Returns cleanup function.
    - src/index.ts: Re-export all from client, server, admin, middleware, session-monitor

    **packages/ui:**
    - package.json: name "@ephraimcare/ui", main "src/index.ts", deps: react, clsx, tailwind-merge, tw-animate-css, lucide-react, class-variance-authority
    - src/lib/utils.ts: cn() helper using clsx + tailwind-merge (standard shadcn/ui pattern)
    - src/styles/globals.css: FULL Tailwind CSS 4 theme (exact pattern from research Pattern 4):
      - @import "tailwindcss" and "tw-animate-css"
      - :root CSS variables with Ephraim Care OKLCH tokens (primary green, secondary teal)
      - --font-heading: 'Montserrat', sans-serif
      - --font-body: 'Inter', sans-serif
      - --radius: 8px
      - .dark block with dark mode overrides
      - @theme inline block mapping CSS vars to Tailwind tokens
      - @source paths for apps/admin, apps/participant, and packages/ui
    - src/components/footer.tsx: "Powered by OpBros" footer component (INFR-08):
      - Fixed at bottom or flex-grow layout
      - Link to https://opbros.online (opens in new tab)
      - Styled with muted text, border-top separator
      - Export as PoweredByFooter
    - src/index.ts: Re-export cn from lib/utils, PoweredByFooter from components/footer
    - components.json: shadcn/ui config for packages/ui (new-york style, from research)

    Then update apps/admin and apps/participant package.json to add workspace:* deps for all @ephraimcare/* packages. Update their app/layout.tsx to import globals.css from @ephraimcare/ui/styles/globals.css. Add the PoweredByFooter to both app layouts.

    Also create apps/admin/components.json and apps/participant/components.json pointing to the shared UI package (from research code examples).
  </action>
  <verify>
    - packages/ui/src/styles/globals.css contains --primary with green OKLCH value
    - packages/supabase/src/middleware.ts contains updateSession function
    - packages/ui/src/components/footer.tsx contains "opbros.online"
    - apps/admin/package.json references @ephraimcare/ui workspace:*
    - pnpm install still resolves after adding workspace references
  </verify>
  <done>Supabase client package and UI theme package exist with Ephraim Care branding and OpBros footer</done>
</task>

</tasks>

<verification>
- All 5 packages exist under packages/ with valid package.json
- pnpm install resolves all workspace:* references
- globals.css has complete Ephraim Care theme tokens
- Supabase client/server/admin/middleware patterns match research
- PoweredByFooter component renders "Powered by OpBros" with link
- Utils package has timezone helpers for Australia/Sydney
</verification>

<success_criteria>
- Five packages (types, supabase, utils, ui, config) exist with implementations
- Workspace references resolve between packages and apps
- Ephraim Care branding tokens defined in CSS
- Supabase auth patterns implemented per research
- OpBros footer component ready for use
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
