---
phase: 01-foundation
plan: 09
type: execute
wave: 6
depends_on: ["01-06", "01-07", "01-08"]
files_modified:
  - packages/types/src/database.ts
  - apps/worker-mobile/app/_layout.tsx
  - apps/worker-mobile/app/index.tsx
autonomous: false

must_haves:
  truths:
    - "pnpm dev starts all three apps without errors"
    - "Admin can log in and see dashboard with role displayed"
    - "Worker role gets access denied when accessing admin"
    - "All database tables have RLS and audit triggers"
    - "Seed data populates successfully and passes constraint checks"
    - "pnpm turbo run test passes all unit tests"
  artifacts:
    - path: "packages/types/src/database.ts"
      provides: "Generated Supabase types from migrations"
      contains: "Database"
  key_links:
    - from: "apps/admin/app/(auth)/login/actions.ts"
      to: "supabase/migrations/20260124000006_create_user_roles.sql"
      via: "login -> JWT claims -> role in dashboard"
      pattern: "signInWithPassword"
---

<objective>
Final integration verification: run all migrations against Supabase, generate types, seed data, start all apps, and verify the complete auth flow works end-to-end. Fix any integration issues between plans.

Purpose: Individual plans may work in isolation but break at integration boundaries. This plan proves the Phase 1 success criteria are met.
Output: All Phase 1 success criteria verified, generated types committed, worker-mobile app minimal screen in place.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-06-SUMMARY.md
@.planning/phases/01-foundation/01-07-SUMMARY.md
@.planning/phases/01-foundation/01-08-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Database integration and type generation</name>
  <files>
    packages/types/src/database.ts
    apps/worker-mobile/app/_layout.tsx
    apps/worker-mobile/app/index.tsx
  </files>
  <action>
    1. **Start Supabase locally:**
       - Run `supabase init` if not already done (config.toml already exists from Plan 03)
       - Run `supabase start` to start local Supabase
       - Verify all migrations apply cleanly: `supabase db reset`
       - Check migration output for errors

    2. **Run seed data:**
       - Execute supabase/seed.sql (runs as part of db reset)
       - Run auth user seed: `npx tsx supabase/seed-auth-users.ts`
       - Verify: query participants table (should have 5 rows)
       - Verify: query shifts table (should have 20 rows)
       - Verify: query invoices table (should have 2 rows)

    3. **Generate Supabase types:**
       - Run `pnpm db:generate-types` (or from supabase dir: supabase gen types typescript --local > ../packages/types/src/database.ts)
       - Verify the generated file has all table types
       - Verify imports work from apps

    4. **Update worker-mobile app for minimal build:**
       - Update apps/worker-mobile/app/_layout.tsx: proper Expo Router Stack layout with navigation container
       - Update apps/worker-mobile/app/index.tsx: Simple screen with "Ephraim Care Worker" title, "Login coming in Phase 5" text, and basic React Native Paper styling

    5. **Verify pnpm dev starts all apps:**
       - Run `pnpm dev` from root (or turbo run dev)
       - Admin should start on port 3000
       - Participant should start on port 3001
       - Worker-mobile may need `expo start` separately (verify it at least doesn't crash)
       - Take note of any errors and fix

    6. **Fix any integration issues:**
       - If import paths break, fix them
       - If TypeScript errors from generated types, update imports
       - If CSS not loading, check @source directives
       - If middleware errors, check Supabase client configuration
  </action>
  <verify>
    - supabase db reset completes without migration errors
    - Generated database.ts has all table types (participants, workers, shifts, invoices, etc.)
    - pnpm dev starts admin (3000) and participant (3001) without errors
    - worker-mobile app launches (expo start) without crash
  </verify>
  <done>Database running with seed data, types generated, all apps start without errors</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Phase 1 foundation:
    - Monorepo with 3 apps and 5 packages
    - 17 SQL migrations with tables, RLS, triggers, and auth hook
    - Auth system (login, reset password, session timeout, RBAC)
    - Admin dashboard with sidebar, role badge, and branding
    - Participant portal with basic dashboard
    - Seed data (5 participants, 5 workers, 20 shifts, 2 invoices)
    - Testing infrastructure (Vitest + Playwright)
  </what-built>
  <how-to-verify>
    1. Open http://localhost:3000/login in browser
    2. Log in with admin@ephraimcare.test / Admin123!
    3. Verify: Dashboard shows with "admin" role badge
    4. Verify: Sidebar has navigation links (Dashboard active, others placeholder)
    5. Verify: "Powered by OpBros" footer visible with link to opbros.online
    6. Verify: Green/teal Ephraim Care branding applied
    7. Sign out, then try logging in with worker1@ephraimcare.test / Worker123!
    8. Verify: Worker gets "Access Denied" or redirected (cannot access admin dashboard)
    9. Open http://localhost:3001/login
    10. Log in with participant1@ephraimcare.test / Part123!
    11. Verify: Participant portal shows basic dashboard
    12. Run `pnpm turbo run test` from root -- verify unit tests pass
  </how-to-verify>
  <resume-signal>Type "approved" if Phase 1 foundation is working, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Phase 1 Success Criteria check:
1. Running `pnpm dev` from monorepo root starts all three apps without errors
2. Admin can log in to the admin portal and see a dashboard shell with their role displayed
3. A user with Worker role cannot access admin-only pages (receives access denied)
4. All database tables have RLS policies and audit trail triggers firing on insert/update/delete
5. Seed data script populates the database with test data that passes all constraint checks
</verification>

<success_criteria>
All 5 Phase 1 success criteria from the roadmap are verified:
- pnpm dev works
- Admin login -> dashboard with role
- Worker blocked from admin
- RLS + audit triggers on all tables
- Seed data populates correctly
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-09-SUMMARY.md`
</output>
