---
phase: 07-invoicing
plan: 03
type: execute
wave: 2
depends_on: ["07-01", "07-02"]
files_modified:
  - apps/admin/app/(protected)/settings/rates/page.tsx
  - apps/admin/app/(protected)/settings/holidays/page.tsx
  - apps/admin/hooks/use-rates.ts
  - apps/admin/hooks/use-holidays.ts
autonomous: true

must_haves:
  truths:
    - "Admin can view all support type rates with weekday/saturday/sunday/holiday columns"
    - "Admin can add a new support type rate with all 4 tier values"
    - "Admin can edit an existing rate"
    - "Admin can view all public holidays with date and name"
    - "Admin can add a new public holiday"
    - "Admin can delete a public holiday"
  artifacts:
    - path: "apps/admin/app/(protected)/settings/rates/page.tsx"
      provides: "Rates settings page"
      min_lines: 80
    - path: "apps/admin/app/(protected)/settings/holidays/page.tsx"
      provides: "Public holidays settings page"
      min_lines: 60
    - path: "apps/admin/hooks/use-rates.ts"
      provides: "TanStack Query hooks for rates CRUD"
      exports: ["useRates", "useCreateRate", "useUpdateRate"]
    - path: "apps/admin/hooks/use-holidays.ts"
      provides: "TanStack Query hooks for holidays CRUD"
      exports: ["useHolidays", "useCreateHoliday", "useDeleteHoliday"]
  key_links:
    - from: "apps/admin/app/(protected)/settings/rates/page.tsx"
      to: "apps/admin/hooks/use-rates.ts"
      via: "useRates and useCreateRate hook calls"
      pattern: "useRates|useCreateRate"
    - from: "apps/admin/hooks/use-rates.ts"
      to: "supabase"
      via: "from('support_type_rates') queries"
      pattern: "support_type_rates"
---

<objective>
Create the settings pages for support type rates (INVC-10) and public holidays management. These are prerequisite for invoice generation since rates determine line item pricing and holidays determine day type.

Purpose: Admin must configure rates before generating invoices. Holidays determine public holiday rates.
Output: Two settings pages with full CRUD and two TanStack Query hook files.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-invoicing/07-CONTEXT.md
@.planning/phases/07-invoicing/07-01-SUMMARY.md
@.planning/phases/07-invoicing/07-02-SUMMARY.md
@apps/admin/app/(protected)/settings/page.tsx
@apps/admin/hooks/use-workers.ts
@apps/admin/lib/invoices/schemas.ts
@apps/admin/lib/invoices/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create rates hooks and settings page</name>
  <files>apps/admin/hooks/use-rates.ts, apps/admin/app/(protected)/settings/rates/page.tsx</files>
  <action>
**use-rates.ts** - TanStack Query hooks following the use-workers.ts pattern:

1. useRates() hook:
   - queryKey: ['rates']
   - queryFn: supabase.from('support_type_rates').select('*').eq('is_active', true).order('support_type') -- cast as any
   - Returns { data, isLoading, error }

2. useCreateRate() mutation hook:
   - mutationFn: insert into support_type_rates with organization_id from user profile
   - onSuccess: invalidateQueries(['rates'])
   - Use (as any) pattern for Supabase insert

3. useUpdateRate() mutation hook:
   - mutationFn: update support_type_rates by id
   - onSuccess: invalidateQueries(['rates'])

Use createBrowserClient from '@/lib/supabase/client'. Follow existing hook patterns (useQueryClient for invalidation, toast on error).

**settings/rates/page.tsx** - Client component ('use client'):

Layout (from CONTEXT.md: "simple and scannable -- all support types visible at once"):
- Page title: "Support Type Rates" with description "Configure hourly rates for each support type"
- "Add Rate" button opens a dialog/inline form
- Table showing all rates:
  - Columns: Support Type | NDIS Item # | Weekday | Saturday | Sunday | Public Holiday | Actions
  - Rate values displayed as currency (e.g., $70.23/hr)
  - Actions: Edit button (opens inline edit or dialog)
- Add/Edit form uses react-hook-form + zodResolver with supportTypeRateSchema
- Form fields: support_type (text input), ndis_item_number (optional text), weekday_rate, saturday_rate, sunday_rate, public_holiday_rate (number inputs), effective_from (date input, defaults to today)
- Support type input should suggest from existing SUPPORT_TYPES if available in shifts/constants, or free text
- Use shadcn Dialog for add/edit modal
- Show toast on success/error (import from '@/lib/toast')

Import Dialog, Button, Input, Label from @ephraimcare/ui (or create inline if not available -- follow existing component patterns in the project).
  </action>
  <verify>Confirm files exist. Check that useRates queries support_type_rates table. Check page.tsx has 'use client' directive and renders a table with rate columns.</verify>
  <done>Rates settings page shows all support types with 4 tier rates. Admin can add and edit rates via dialog form with Zod validation. Data persists via Supabase.</done>
</task>

<task type="auto">
  <name>Task 2: Create holidays hooks and settings page</name>
  <files>apps/admin/hooks/use-holidays.ts, apps/admin/app/(protected)/settings/holidays/page.tsx</files>
  <action>
**use-holidays.ts** - TanStack Query hooks:

1. useHolidays() hook:
   - queryKey: ['holidays']
   - queryFn: supabase.from('public_holidays').select('*').order('holiday_date', { ascending: true }) -- cast as any
   - Returns { data, isLoading }

2. useCreateHoliday() mutation hook:
   - mutationFn: insert into public_holidays with organization_id and created_by from user
   - onSuccess: invalidateQueries(['holidays'])

3. useDeleteHoliday() mutation hook:
   - mutationFn: delete from public_holidays by id
   - onSuccess: invalidateQueries(['holidays'])

**settings/holidays/page.tsx** - Client component ('use client'):

Simple CRUD layout per CONTEXT.md:
- Page title: "Public Holidays" with description "Manage public holiday dates for rate calculations"
- "Add Holiday" button opens inline form or dialog
- Add form: date picker (native date input) + name text input + "Add" button
- List of holidays sorted by date:
  - Each row: Date (formatted en-AU) | Name | Delete button (with confirmation)
  - Use Trash2 icon from lucide-react for delete
- Show toast on success/error
- Empty state: "No public holidays configured. Shifts on unconfigured dates will use weekday rates."

Keep it simple -- this is a basic CRUD list, not a complex table. No search/filter needed (holiday list is small).
  </action>
  <verify>Confirm both files exist. Check useHolidays queries public_holidays. Check page has add form with date and name fields plus delete capability.</verify>
  <done>Holidays settings page shows all configured holidays sorted by date. Admin can add (date + name) and delete holidays. Changes take effect for future invoice generation only.</done>
</task>

</tasks>

<verification>
- Rates page renders a table with all 4 tier rate columns
- Rates can be added with all required fields validated by Zod
- Holidays page shows a list sortable by date
- Holidays can be added and deleted
- Both pages use TanStack Query for data fetching (not just server-side)
- Toast notifications appear on success/error
</verification>

<success_criteria>
- INVC-10 satisfied: Admin can configure support type hourly rates
- Public holidays are manageable (CRUD) for day type determination
- Data persists in Supabase tables created by Plan 01
</success_criteria>

<output>
After completion, create `.planning/phases/07-invoicing/07-03-SUMMARY.md`
</output>
