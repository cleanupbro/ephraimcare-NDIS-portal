---
phase: 11-compliance-incidents
plan: 05
type: execute
wave: 2
depends_on: [11-01]
files_modified:
  - apps/participant/app/(protected)/appointments/page.tsx
  - apps/participant/components/appointments/appointment-card.tsx
  - apps/participant/components/appointments/cancellation-request-dialog.tsx
  - apps/participant/hooks/use-appointments.ts
  - apps/admin/app/(protected)/cancellation-requests/page.tsx
  - apps/admin/hooks/use-cancellation-requests.ts
autonomous: true

must_haves:
  truths:
    - "Participant sees upcoming appointments with worker name and time"
    - "Participant can request shift cancellation with reason"
    - "Admin can approve/reject cancellation requests"
---

<objective>
Add appointments view and cancellation request flow to participant portal.

Purpose: Allow participants to view their schedule and request changes.

Output: Appointments page in participant portal, cancellation request dialog, admin review page.
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Create participant appointments hooks</name>
  <files>apps/participant/hooks/use-appointments.ts</files>
  <action>
Hooks for:
- useUpcomingAppointments: shifts for participant, status != cancelled, date >= today
- useCreateCancellationRequest: mutation to create request
  </action>
</task>

<task type="auto">
  <name>Task 2: Create appointments page</name>
  <files>apps/participant/app/(protected)/appointments/page.tsx</files>
  <action>
Page showing:
- List of upcoming shifts as cards
- Each card: date, time, worker name, support type
- "Request Cancellation" button on each card
  </action>
</task>

<task type="auto">
  <name>Task 3: Create cancellation request dialog</name>
  <files>apps/participant/components/appointments/cancellation-request-dialog.tsx</files>
  <action>
AlertDialog with:
- Shift details (date, time, worker)
- Reason textarea (required, min 10 chars)
- Submit button
- Success toast on submit
  </action>
</task>

<task type="auto">
  <name>Task 4: Create admin cancellation requests page</name>
  <files>apps/admin/app/(protected)/cancellation-requests/page.tsx</files>
  <action>
Page showing:
- List of pending requests
- Each row: participant, shift date/time, reason
- Approve/Reject buttons
- On approve: update request status, cancel shift
  </action>
</task>

<task type="auto">
  <name>Task 5: Add to navigation</name>
  <action>
- Add "Appointments" to participant sidebar
- Add "Cancellation Requests" to admin sidebar (with pending count badge)
  </action>
</task>

</tasks>

<success_criteria>
- Participant sees upcoming appointments ordered by date
- Request cancellation shows dialog with reason field
- Admin sees pending requests and can approve/reject
- Approved request cancels the shift
</success_criteria>
