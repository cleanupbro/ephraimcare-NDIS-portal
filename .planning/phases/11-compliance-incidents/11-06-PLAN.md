---
phase: 11-compliance-incidents
plan: 06
type: execute
wave: 2
depends_on: []
files_modified:
  - apps/participant/app/(auth)/login/page.tsx
  - apps/participant/app/(auth)/auth/callback/route.ts
autonomous: true

must_haves:
  truths:
    - "Participant can request magic link via email"
    - "Clicking magic link logs participant in"
    - "Existing password login still works"
---

<objective>
Add magic link authentication option for participant portal.

Purpose: Provide passwordless login option for participants who may have difficulty with passwords.

Output: Updated login page with magic link option, callback route handler.
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Update login page with magic link option</name>
  <files>apps/participant/app/(auth)/login/page.tsx</files>
  <action>
Add to login page:
- Tabs or toggle: "Password" | "Magic Link"
- Magic link form: email input only
- On submit: call supabase.auth.signInWithOtp({ email, options: { emailRedirectTo } })
- Show success message: "Check your email for login link"
  </action>
</task>

<task type="auto">
  <name>Task 2: Create auth callback route</name>
  <files>apps/participant/app/(auth)/auth/callback/route.ts</files>
  <action>
Route handler that:
- Exchanges code for session
- Verifies user is participant role
- Redirects to /dashboard on success
- Redirects to /login with error on failure
  </action>
</task>

</tasks>

<success_criteria>
- Login page shows magic link option
- Submitting email sends magic link
- Clicking link in email logs user in
- Password login still works
</success_criteria>
