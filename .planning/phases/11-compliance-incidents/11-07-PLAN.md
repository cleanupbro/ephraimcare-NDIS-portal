---
phase: 11-compliance-incidents
plan: 07
type: execute
wave: 2
depends_on: []
files_modified:
  - apps/admin/app/(protected)/shifts/calendar/page.tsx
  - apps/admin/components/shifts/calendar-view.tsx
  - apps/admin/components/shifts/recurring-shift-form.tsx
  - apps/admin/app/api/shifts/recurring/route.ts
autonomous: true

must_haves:
  truths:
    - "Admin can view shifts in calendar format (day/week/month)"
    - "Admin can create recurring shifts (repeat weekly for N weeks)"
    - "Recurring shifts generate individual shift records"
---

<objective>
Add calendar view and recurring shift creation to shift management.

Purpose: Improve scheduling visibility and efficiency for regular appointments.

Output: Calendar view page, recurring shift form, batch shift creation API.
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Create calendar view component</name>
  <files>apps/admin/components/shifts/calendar-view.tsx</files>
  <action>
Custom calendar grid component:
- Week view (default): 7-day grid with time slots
- Day view: Single day with 30-min slots
- Month view: Traditional month grid with shift dots
- View toggle buttons
- Click shift to open detail sheet
- Uses date-fns for date calculations
  </action>
</task>

<task type="auto">
  <name>Task 2: Create calendar page</name>
  <files>apps/admin/app/(protected)/shifts/calendar/page.tsx</files>
  <action>
Page with:
- CalendarView component
- Date navigation (prev/next/today)
- Filter by participant/worker
- Link to list view
  </action>
</task>

<task type="auto">
  <name>Task 3: Create recurring shift form</name>
  <files>apps/admin/components/shifts/recurring-shift-form.tsx</files>
  <action>
Form extending base shift form with:
- Days of week checkboxes (Mon-Sun)
- Number of weeks (1-12)
- Preview showing dates to be created
- Warning if any date has conflicts
  </action>
</task>

<task type="auto">
  <name>Task 4: Create recurring shift API</name>
  <files>apps/admin/app/api/shifts/recurring/route.ts</files>
  <action>
POST route that:
- Receives pattern (days, weeks, base shift data)
- Generates all dates
- Creates shifts in batch
- Returns created shift count
  </action>
</task>

<task type="auto">
  <name>Task 5: Add calendar link to shifts page</name>
  <action>
Add "Calendar View" button to /shifts page header.
Add "Create Recurring" option to shift creation.
  </action>
</task>

</tasks>

<success_criteria>
- Calendar shows shifts in week/day/month views
- Clicking shift opens detail
- Recurring form generates multiple shifts
- Created shifts appear in both list and calendar
</success_criteria>
