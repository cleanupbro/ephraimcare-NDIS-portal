---
phase: 11-compliance-incidents
plan: 04
type: execute
wave: 2
depends_on: [11-01]
files_modified:
  - apps/admin/app/(protected)/compliance/page.tsx
  - apps/admin/components/compliance/health-score-card.tsx
  - apps/admin/components/compliance/compliance-breakdown.tsx
  - apps/admin/hooks/use-compliance.ts
  - apps/admin/app/api/compliance/report/route.ts
autonomous: true

must_haves:
  truths:
    - "Dashboard shows overall compliance health score percentage"
    - "Dashboard shows breakdown: workers, incidents, documentation"
    - "Compliance report exportable as PDF"
---

<objective>
Build compliance health dashboard with score calculation and PDF export.

Purpose: Give administrators a single view of organizational compliance status.

Output: Compliance dashboard page with health score, breakdowns, and PDF export.
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Create compliance hooks</name>
  <files>apps/admin/hooks/use-compliance.ts</files>
  <action>
Create hooks that calculate:
- Worker compliance rate (valid checks / total active workers)
- Incident resolution rate (closed incidents / total incidents this month)
- Documentation rate (participants with complete plans / total)
- Overall health score weighted average
  </action>
</task>

<task type="auto">
  <name>Task 2: Create health score card</name>
  <files>apps/admin/components/compliance/health-score-card.tsx</files>
  <action>
Large card showing:
- Circular progress indicator with score percentage
- Color: green (80+), amber (60-79), red (<60)
- "Compliance Health" title
  </action>
</task>

<task type="auto">
  <name>Task 3: Create compliance breakdown</name>
  <files>apps/admin/components/compliance/compliance-breakdown.tsx</files>
  <action>
Grid of cards showing:
- Workers: X valid, Y expiring, Z expired
- Incidents: X open, Y in review this month
- Documentation: X complete, Y incomplete
  </action>
</task>

<task type="auto">
  <name>Task 4: Create compliance page</name>
  <files>apps/admin/app/(protected)/compliance/page.tsx</files>
  <action>
Page layout:
- Health score card (hero)
- Breakdown grid
- "Export Report" button
- Add to sidebar navigation
  </action>
</task>

<task type="auto">
  <name>Task 5: Create PDF export API</name>
  <files>apps/admin/app/api/compliance/report/route.ts</files>
  <action>
GET route that:
- Fetches compliance data
- Generates PDF with @react-pdf/renderer
- Returns PDF blob
  </action>
</task>

</tasks>

<success_criteria>
- Compliance page shows health score with color coding
- Breakdown shows worker, incident, documentation stats
- PDF export downloads branded compliance report
</success_criteria>
