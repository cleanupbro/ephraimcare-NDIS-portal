---
phase: 11-compliance-incidents
plan: 03
type: execute
wave: 2
depends_on: [11-02]
files_modified:
  - apps/admin/app/(protected)/incidents/[id]/page.tsx
  - apps/admin/components/incidents/ndia-report-dialog.tsx
  - apps/admin/components/incidents/incident-detail.tsx
autonomous: true

must_haves:
  truths:
    - "Incidents requiring NDIA report show 24-hour countdown"
    - "Coordinator can mark incident as reported with reference number"
    - "Incident detail page shows full incident information"
---

<objective>
Build NDIA reporting workflow with countdown timer and reference number capture.

Purpose: Ensure compliance with NDIA 24-hour reporting requirement for critical incidents.

Output: Incident detail page with NDIA reporting dialog and countdown timer.
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Create incident detail page</name>
  <files>apps/admin/app/(protected)/incidents/[id]/page.tsx</files>
  <action>
Create detail page showing:
- Incident header with title, type badge, severity badge, status badge
- NDIA alert banner if requires_ndia_report && !ndia_reported_at
- Countdown timer showing hours remaining until 24h deadline
- Description, actions taken, location
- Related participant/worker/shift info
- Edit and Close buttons
  </action>
</task>

<task type="auto">
  <name>Task 2: Create NDIA report dialog</name>
  <files>apps/admin/components/incidents/ndia-report-dialog.tsx</files>
  <action>
AlertDialog with:
- Reference number input field
- "Mark as Reported" button
- On submit: update incident with ndia_reported_at, ndia_reference_number, ndia_reported_by
  </action>
</task>

<task type="auto">
  <name>Task 3: Add countdown timer component</name>
  <files>apps/admin/components/incidents/ndia-countdown.tsx</files>
  <action>
Component that:
- Calculates hours remaining from incident_date + 24h
- Shows red if < 4 hours remaining
- Shows amber if < 12 hours remaining
- Shows "Overdue" if past deadline
  </action>
</task>

</tasks>

<success_criteria>
- Detail page shows all incident information
- NDIA banner shows countdown with color coding
- Marking as reported saves reference number and timestamp
- Overdue incidents clearly marked
</success_criteria>
