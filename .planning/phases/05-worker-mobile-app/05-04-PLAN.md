---
phase: 05-worker-mobile-app
plan: 04
type: execute
wave: 3
depends_on: ["05-02", "05-03"]
files_modified:
  - apps/worker-mobile/components/ShiftCard.tsx
  - apps/worker-mobile/app/(tabs)/index.tsx
  - apps/worker-mobile/app/(tabs)/_layout.tsx
autonomous: true

must_haves:
  truths:
    - "Home screen shows today's shifts in chronological order with participant name and time range"
    - "Each shift card shows a colored status dot (pending=orange, confirmed=green, in_progress=blue, completed=grey)"
    - "Tapping a shift card navigates to the shift detail screen"
    - "Empty state shows next upcoming shift info when no shifts today"
    - "Bottom navigation has 4 tabs: Home, Schedule, My Notes, Profile"
  artifacts:
    - path: "apps/worker-mobile/components/ShiftCard.tsx"
      provides: "Compact shift card with participant name, time range, and status dot"
      exports: ["ShiftCard"]
    - path: "apps/worker-mobile/app/(tabs)/index.tsx"
      provides: "Home screen listing today's shifts chronologically"
      contains: "useTodayShifts"
    - path: "apps/worker-mobile/app/(tabs)/_layout.tsx"
      provides: "4-tab bottom navigation with icons"
      contains: "Tabs.Screen"
  key_links:
    - from: "apps/worker-mobile/app/(tabs)/index.tsx"
      to: "apps/worker-mobile/hooks/useShifts.ts"
      via: "useTodayShifts(userId)"
      pattern: "useTodayShifts"
    - from: "apps/worker-mobile/components/ShiftCard.tsx"
      to: "expo-router"
      via: "router.push(/shift/[id])"
      pattern: "router\\.push.*shift"
---

<objective>
Home screen with today's shifts and 4-tab bottom navigation for the worker mobile app.

Purpose: This is the first screen workers see after login (MOBL-01). It shows their daily schedule at a glance with minimal info (participant name + time + status). The tab layout (MOBL-12) provides navigation structure for the entire app.

Output: ShiftCard component, Home tab with today's shifts, 4-tab bottom navigation layout.
</objective>

<execution_context>
@/Users/shamalkrishna/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shamalkrishna/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/05-worker-mobile-app/05-RESEARCH.md
@apps/worker-mobile/hooks/useAuth.tsx
@apps/worker-mobile/hooks/useShifts.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: ShiftCard component and tab layout</name>
  <files>apps/worker-mobile/components/ShiftCard.tsx, apps/worker-mobile/app/(tabs)/_layout.tsx</files>
  <action>
1. **Create components/ShiftCard.tsx:**

A compact card showing: status dot (colored by status) + participant name + time range. Tappable to navigate to shift detail.

```typescript
import { View } from 'react-native'
import { Card, Text } from 'react-native-paper'
import { useRouter } from 'expo-router'
import { format, parseISO } from 'date-fns'

export interface ShiftCardProps {
  id: string
  participantFirstName: string
  participantLastName: string
  scheduledStart: string  // ISO time string
  scheduledEnd: string    // ISO time string
  status: string
  supportType: string
}

const STATUS_COLORS: Record<string, string> = {
  pending: '#FFA726',     // orange
  proposed: '#FFA726',    // orange
  confirmed: '#66BB6A',   // green
  in_progress: '#42A5F5', // blue
  completed: '#BDBDBD',   // grey
}

export function ShiftCard({
  id, participantFirstName, participantLastName,
  scheduledStart, scheduledEnd, status, supportType,
}: ShiftCardProps) {
  const router = useRouter()
  const dotColor = STATUS_COLORS[status] ?? '#BDBDBD'

  // Parse time from ISO string (already in local time from scheduled_start column)
  const startFormatted = format(parseISO(scheduledStart), 'h:mm a')
  const endFormatted = format(parseISO(scheduledEnd), 'h:mm a')

  return (
    <Card
      onPress={() => router.push(`/shift/${id}`)}
      style={{ marginBottom: 8, borderRadius: 8 }}
      mode="elevated"
    >
      <Card.Content style={{ flexDirection: 'row', alignItems: 'center', gap: 12, paddingVertical: 12 }}>
        <View style={{
          width: 10, height: 10, borderRadius: 5,
          backgroundColor: dotColor,
        }} />
        <View style={{ flex: 1 }}>
          <Text variant="titleSmall">
            {participantFirstName} {participantLastName}
          </Text>
          <Text variant="bodySmall" style={{ color: '#666', marginTop: 2 }}>
            {startFormatted} - {endFormatted}
          </Text>
        </View>
        <Text variant="labelSmall" style={{ color: '#999' }}>
          {supportType}
        </Text>
      </Card.Content>
    </Card>
  )
}
```

2. **Replace app/(tabs)/_layout.tsx** with proper 4-tab layout:

```typescript
import { Tabs } from 'expo-router'
import { MaterialCommunityIcons } from '@expo/vector-icons'

export default function TabLayout() {
  return (
    <Tabs
      screenOptions={{
        tabBarActiveTintColor: '#66BB6A',
        tabBarInactiveTintColor: '#999',
        headerStyle: { backgroundColor: '#fff' },
        headerTitleStyle: { fontWeight: '600' },
      }}
    >
      <Tabs.Screen
        name="index"
        options={{
          title: 'Home',
          tabBarIcon: ({ color, size }) => (
            <MaterialCommunityIcons name="home" size={size} color={color} />
          ),
        }}
      />
      <Tabs.Screen
        name="schedule"
        options={{
          title: 'Schedule',
          tabBarIcon: ({ color, size }) => (
            <MaterialCommunityIcons name="calendar-week" size={size} color={color} />
          ),
        }}
      />
      <Tabs.Screen
        name="notes"
        options={{
          title: 'My Notes',
          tabBarIcon: ({ color, size }) => (
            <MaterialCommunityIcons name="note-text" size={size} color={color} />
          ),
        }}
      />
      <Tabs.Screen
        name="profile"
        options={{
          title: 'Profile',
          tabBarIcon: ({ color, size }) => (
            <MaterialCommunityIcons name="account" size={size} color={color} />
          ),
        }}
      />
    </Tabs>
  )
}
```

Also rename `app/(tabs)/shifts.tsx` to `app/(tabs)/index.tsx` (the home tab). Delete the old shifts.tsx file after creating index.tsx.

Create placeholder `app/(tabs)/schedule.tsx` with "Schedule coming soon" text (will be implemented in Plan 07).
  </action>
  <verify>Check files exist: `ls apps/worker-mobile/components/ShiftCard.tsx apps/worker-mobile/app/\(tabs\)/_layout.tsx apps/worker-mobile/app/\(tabs\)/index.tsx`</verify>
  <done>ShiftCard renders status dot + name + time range. Tab layout has 4 tabs with MaterialCommunityIcons. Home tab file is index.tsx (renamed from shifts.tsx). Schedule placeholder created.</done>
</task>

<task type="auto">
  <name>Task 2: Home screen with today's shifts and empty state</name>
  <files>apps/worker-mobile/app/(tabs)/index.tsx</files>
  <action>
Create the Home tab screen that shows today's shifts:

```typescript
// app/(tabs)/index.tsx
import { View, FlatList, RefreshControl } from 'react-native'
import { Text, ActivityIndicator } from 'react-native-paper'
import { useSession } from '../../hooks/useAuth'
import { useTodayShifts, useWeekShifts } from '../../hooks/useShifts'
import { ShiftCard } from '../../components/ShiftCard'
import { format, isAfter } from 'date-fns'

export default function HomeScreen() {
  const { userId } = useSession()
  const { data: shifts, isLoading, refetch, isRefetching } = useTodayShifts(userId)

  if (isLoading) {
    return (
      <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
        <ActivityIndicator size="large" color="#66BB6A" />
      </View>
    )
  }

  if (!shifts || shifts.length === 0) {
    return <EmptyState userId={userId} />
  }

  return (
    <View style={{ flex: 1, backgroundColor: '#F5F5F5' }}>
      <View style={{ paddingHorizontal: 16, paddingTop: 16, paddingBottom: 8 }}>
        <Text variant="titleMedium" style={{ color: '#333' }}>
          Today, {format(new Date(), 'EEEE d MMM')}
        </Text>
      </View>
      <FlatList
        data={shifts}
        keyExtractor={(item) => item.id}
        contentContainerStyle={{ paddingHorizontal: 16, paddingBottom: 16 }}
        refreshControl={
          <RefreshControl refreshing={isRefetching} onRefresh={refetch} colors={['#66BB6A']} />
        }
        renderItem={({ item }) => (
          <ShiftCard
            id={item.id}
            participantFirstName={item.participant?.first_name ?? ''}
            participantLastName={item.participant?.last_name ?? ''}
            scheduledStart={item.scheduled_start}
            scheduledEnd={item.scheduled_end}
            status={item.status}
            supportType={item.support_type}
          />
        )}
      />
    </View>
  )
}

// Empty state component showing next upcoming shift
function EmptyState({ userId }: { userId: string | null }) {
  // Fetch this week's shifts to find next upcoming
  const { data: weekShifts } = useWeekShifts(userId)
  const now = new Date()
  const nextShift = weekShifts?.find((s) => {
    const shiftStart = new Date(`${s.scheduled_date}T${s.scheduled_start}`)
    return isAfter(shiftStart, now)
  })

  return (
    <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center', padding: 24, backgroundColor: '#F5F5F5' }}>
      <Text variant="titleMedium" style={{ color: '#333', marginBottom: 8 }}>
        No shifts today
      </Text>
      {nextShift ? (
        <Text variant="bodyMedium" style={{ color: '#666', textAlign: 'center' }}>
          Next shift: {format(new Date(nextShift.scheduled_date), 'EEEE')} at{' '}
          {format(new Date(`${nextShift.scheduled_date}T${nextShift.scheduled_start}`), 'h:mm a')}{' '}
          with {nextShift.participant?.first_name} {nextShift.participant?.last_name?.charAt(0)}.
        </Text>
      ) : (
        <Text variant="bodyMedium" style={{ color: '#666' }}>
          No upcoming shifts this week.
        </Text>
      )}
    </View>
  )
}
```

Key points:
- FlatList for performant scrolling with many shifts
- Pull-to-refresh via RefreshControl
- Shows "Today, Monday 24 Jan" header
- Empty state fetches week shifts to find next upcoming shift
- Empty state format: "Next shift: Wednesday at 2:00 PM with John S."
- Participant last name truncated to initial for privacy in quick view
- Loading spinner while fetching
  </action>
  <verify>Check: `grep "useTodayShifts" apps/worker-mobile/app/\(tabs\)/index.tsx` and `grep "EmptyState" apps/worker-mobile/app/\(tabs\)/index.tsx`</verify>
  <done>Home screen shows today's shifts chronologically using ShiftCard. Empty state shows next upcoming shift. Pull-to-refresh supported. Loading spinner during initial fetch.</done>
</task>

</tasks>

<verification>
- ShiftCard renders with correct status color, name, and formatted time
- Tab layout shows 4 tabs with icons: Home, Schedule, My Notes, Profile
- Home screen calls useTodayShifts with current user ID
- Empty state displays next upcoming shift from week data
- Pull-to-refresh triggers refetch
- Old shifts.tsx file removed, index.tsx is the home tab
</verification>

<success_criteria>
- Worker opens app and sees today's shifts listed by time (MOBL-01)
- Each shift shows participant name, time range, and colored status dot
- Tapping a card navigates to /shift/[id]
- No shifts today shows helpful "Next shift: ..." message
- 4 tabs visible in bottom navigation (MOBL-12)
</success_criteria>

<output>
After completion, create `.planning/phases/05-worker-mobile-app/05-04-SUMMARY.md`
</output>
