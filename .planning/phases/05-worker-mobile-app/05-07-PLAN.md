---
phase: 05-worker-mobile-app
plan: 07
type: execute
wave: 3
depends_on: ["05-02", "05-03"]
files_modified:
  - apps/worker-mobile/components/WeeklyCalendar.tsx
  - apps/worker-mobile/app/(tabs)/schedule.tsx
  - apps/worker-mobile/app/(tabs)/profile.tsx
  - apps/worker-mobile/app/(tabs)/notes.tsx
autonomous: true

must_haves:
  truths:
    - "Worker can view weekly schedule with 7-column calendar grid showing shifts as colored time blocks"
    - "Worker can navigate between weeks (previous/next)"
    - "Profile screen shows worker name, email, and a logout button"
    - "My Notes tab shows placeholder for case notes list (Phase 6 dependency)"
    - "Logout clears session and returns to login screen"
  artifacts:
    - path: "apps/worker-mobile/components/WeeklyCalendar.tsx"
      provides: "7-column calendar grid with shifts as colored time blocks"
      exports: ["WeeklyCalendar"]
    - path: "apps/worker-mobile/app/(tabs)/schedule.tsx"
      provides: "Schedule tab with WeeklyCalendar and week navigation"
      contains: "useWeekShifts"
    - path: "apps/worker-mobile/app/(tabs)/profile.tsx"
      provides: "Profile tab with worker info and logout"
      contains: "signOut"
    - path: "apps/worker-mobile/app/(tabs)/notes.tsx"
      provides: "My Notes tab placeholder (Phase 6 will implement)"
      contains: "notes"
  key_links:
    - from: "apps/worker-mobile/app/(tabs)/schedule.tsx"
      to: "apps/worker-mobile/hooks/useShifts.ts"
      via: "useWeekShifts(userId, weekStart)"
      pattern: "useWeekShifts"
    - from: "apps/worker-mobile/app/(tabs)/profile.tsx"
      to: "apps/worker-mobile/hooks/useAuth.tsx"
      via: "useSession().signOut"
      pattern: "signOut"
---

<objective>
Weekly schedule calendar, profile screen with logout, and notes placeholder tab.

Purpose: Workers need a visual weekly overview (MOBL-06) using a 7-column calendar grid that shows shifts as colored time blocks. The profile screen provides logout functionality, and the notes tab is a placeholder for Phase 6's case notes system.

Output: WeeklyCalendar component, schedule tab with week navigation, profile tab with logout, notes tab placeholder.
</objective>

<execution_context>
@/Users/shamalkrishna/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shamalkrishna/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/05-worker-mobile-app/05-RESEARCH.md
@apps/worker-mobile/hooks/useShifts.ts
@apps/worker-mobile/hooks/useAuth.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: WeeklyCalendar component and schedule tab</name>
  <files>apps/worker-mobile/components/WeeklyCalendar.tsx, apps/worker-mobile/app/(tabs)/schedule.tsx</files>
  <action>
1. **Create components/WeeklyCalendar.tsx:**

A 7-column grid (Mon-Sun) showing shifts as colored blocks positioned by time. Each column represents a day. Shifts render as small colored rectangles at their time position.

```typescript
import { View, Dimensions, TouchableOpacity } from 'react-native'
import { Text } from 'react-native-paper'
import { format, addDays, isSameDay, parseISO } from 'date-fns'
import { useRouter } from 'expo-router'
import type { ShiftWithParticipant } from '../hooks/useShifts'

interface WeeklyCalendarProps {
  weekStart: Date // Monday of the week
  shifts: ShiftWithParticipant[]
}

const STATUS_COLORS: Record<string, string> = {
  pending: '#FFA726',
  proposed: '#FFA726',
  confirmed: '#66BB6A',
  in_progress: '#42A5F5',
  completed: '#BDBDBD',
}

const HOUR_HEIGHT = 40 // pixels per hour
const START_HOUR = 6   // Display from 6 AM
const END_HOUR = 22    // Display to 10 PM
const TOTAL_HOURS = END_HOUR - START_HOUR

export function WeeklyCalendar({ weekStart, shifts }: WeeklyCalendarProps) {
  const router = useRouter()
  const screenWidth = Dimensions.get('window').width
  const columnWidth = (screenWidth - 40) / 7 // 40px for time labels
  const today = new Date()

  // Group shifts by day of week
  const days = Array.from({ length: 7 }, (_, i) => addDays(weekStart, i))

  function getShiftPosition(shift: ShiftWithParticipant) {
    const start = parseISO(shift.scheduled_start)
    const end = parseISO(shift.scheduled_end)
    const startHour = start.getHours() + start.getMinutes() / 60
    const endHour = end.getHours() + end.getMinutes() / 60
    const top = (Math.max(startHour, START_HOUR) - START_HOUR) * HOUR_HEIGHT
    const height = (Math.min(endHour, END_HOUR) - Math.max(startHour, START_HOUR)) * HOUR_HEIGHT
    return { top, height: Math.max(height, 20) }
  }

  return (
    <View style={{ flex: 1 }}>
      {/* Day headers */}
      <View style={{ flexDirection: 'row', paddingLeft: 40 }}>
        {days.map((day, i) => (
          <View key={i} style={{
            width: columnWidth,
            alignItems: 'center',
            paddingVertical: 8,
            backgroundColor: isSameDay(day, today) ? '#E8F5E9' : 'transparent',
            borderRadius: 4,
          }}>
            <Text variant="labelSmall" style={{ color: '#999' }}>
              {format(day, 'EEE')}
            </Text>
            <Text variant="labelMedium" style={{
              fontWeight: isSameDay(day, today) ? '700' : '400',
              color: isSameDay(day, today) ? '#66BB6A' : '#333',
            }}>
              {format(day, 'd')}
            </Text>
          </View>
        ))}
      </View>

      {/* Time grid */}
      <View style={{ flex: 1, flexDirection: 'row' }}>
        {/* Time labels */}
        <View style={{ width: 40 }}>
          {Array.from({ length: TOTAL_HOURS }, (_, i) => (
            <View key={i} style={{ height: HOUR_HEIGHT, justifyContent: 'flex-start' }}>
              <Text variant="labelSmall" style={{ color: '#999', fontSize: 10 }}>
                {format(new Date(2000, 0, 1, START_HOUR + i), 'ha')}
              </Text>
            </View>
          ))}
        </View>

        {/* Day columns with shifts */}
        {days.map((day, dayIndex) => {
          const dayShifts = shifts.filter((s) =>
            isSameDay(new Date(s.scheduled_date), day)
          )
          return (
            <View key={dayIndex} style={{
              width: columnWidth,
              height: TOTAL_HOURS * HOUR_HEIGHT,
              borderLeftWidth: 0.5,
              borderLeftColor: '#E0E0E0',
              position: 'relative',
            }}>
              {/* Hour grid lines */}
              {Array.from({ length: TOTAL_HOURS }, (_, i) => (
                <View key={i} style={{
                  position: 'absolute',
                  top: i * HOUR_HEIGHT,
                  left: 0, right: 0,
                  borderTopWidth: 0.5,
                  borderTopColor: '#F0F0F0',
                }} />
              ))}
              {/* Shift blocks */}
              {dayShifts.map((shift) => {
                const pos = getShiftPosition(shift)
                const color = STATUS_COLORS[shift.status] ?? '#BDBDBD'
                return (
                  <TouchableOpacity
                    key={shift.id}
                    onPress={() => router.push(`/shift/${shift.id}`)}
                    style={{
                      position: 'absolute',
                      top: pos.top,
                      height: pos.height,
                      left: 2,
                      right: 2,
                      backgroundColor: color + '30',
                      borderLeftWidth: 3,
                      borderLeftColor: color,
                      borderRadius: 4,
                      padding: 2,
                      overflow: 'hidden',
                    }}
                  >
                    <Text style={{ fontSize: 9, color: '#333', fontWeight: '500' }} numberOfLines={1}>
                      {shift.participant?.first_name}
                    </Text>
                  </TouchableOpacity>
                )
              })}
            </View>
          )
        })}
      </View>
    </View>
  )
}
```

2. **Create app/(tabs)/schedule.tsx:**

```typescript
import { useState } from 'react'
import { View, ScrollView } from 'react-native'
import { Text, IconButton } from 'react-native-paper'
import { startOfWeek, addWeeks, format } from 'date-fns'
import { useSession } from '../../hooks/useAuth'
import { useWeekShifts } from '../../hooks/useShifts'
import { WeeklyCalendar } from '../../components/WeeklyCalendar'

export default function ScheduleScreen() {
  const { userId } = useSession()
  const [weekStart, setWeekStart] = useState(
    startOfWeek(new Date(), { weekStartsOn: 1 })
  )
  const { data: shifts, isLoading } = useWeekShifts(userId, weekStart)

  return (
    <View style={{ flex: 1, backgroundColor: '#fff' }}>
      {/* Week navigation header */}
      <View style={{ flexDirection: 'row', alignItems: 'center', justifyContent: 'space-between', paddingHorizontal: 8, paddingVertical: 4 }}>
        <IconButton
          icon="chevron-left"
          onPress={() => setWeekStart((s) => addWeeks(s, -1))}
        />
        <Text variant="titleSmall">
          {format(weekStart, 'd MMM')} - {format(addWeeks(weekStart, 1), 'd MMM yyyy')}
        </Text>
        <IconButton
          icon="chevron-right"
          onPress={() => setWeekStart((s) => addWeeks(s, 1))}
        />
      </View>

      {/* Calendar grid */}
      <ScrollView style={{ flex: 1 }}>
        <WeeklyCalendar weekStart={weekStart} shifts={shifts ?? []} />
      </ScrollView>
    </View>
  )
}
```

Key points:
- Calendar shows colored time blocks (not a list)
- Blocks positioned by time within day columns
- Today's column highlighted with green background
- Tapping a shift block navigates to shift detail
- Week navigation with left/right arrows
- Time labels on left (6AM-10PM range)
- Participant first name shown in block (truncated for small blocks)
  </action>
  <verify>Check: `grep "WeeklyCalendar\|useWeekShifts" apps/worker-mobile/app/\(tabs\)/schedule.tsx` and `ls apps/worker-mobile/components/WeeklyCalendar.tsx`</verify>
  <done>WeeklyCalendar renders 7-column grid with shifts as colored time blocks. Schedule tab has week navigation. Today highlighted. Tapping blocks navigates to shift detail.</done>
</task>

<task type="auto">
  <name>Task 2: Profile screen with logout and notes placeholder</name>
  <files>apps/worker-mobile/app/(tabs)/profile.tsx, apps/worker-mobile/app/(tabs)/notes.tsx</files>
  <action>
1. **Replace app/(tabs)/profile.tsx:**

```typescript
import { View } from 'react-native'
import { Text, Button, Card, Divider } from 'react-native-paper'
import { useSession } from '../../hooks/useAuth'
import { useSyncStore } from '../../stores/syncStore'

export default function ProfileScreen() {
  const { session, signOut } = useSession()
  const pendingCount = useSyncStore((s) => s.pendingActions.length)

  const userEmail = session?.user?.email ?? 'Unknown'
  const userName = session?.user?.user_metadata?.full_name
    ?? session?.user?.user_metadata?.name
    ?? userEmail.split('@')[0]

  return (
    <View style={{ flex: 1, backgroundColor: '#F5F5F5', padding: 16 }}>
      <Card style={{ marginBottom: 16 }}>
        <Card.Content>
          <Text variant="titleLarge" style={{ fontWeight: '600' }}>{userName}</Text>
          <Text variant="bodyMedium" style={{ color: '#666', marginTop: 4 }}>{userEmail}</Text>
          <Text variant="bodySmall" style={{ color: '#999', marginTop: 2 }}>Worker</Text>
        </Card.Content>
      </Card>

      {/* Sync status */}
      {pendingCount > 0 && (
        <Card style={{ marginBottom: 16, backgroundColor: '#FFF8E1' }}>
          <Card.Content>
            <Text variant="bodySmall" style={{ color: '#F57F17' }}>
              {pendingCount} action{pendingCount > 1 ? 's' : ''} pending sync
            </Text>
          </Card.Content>
        </Card>
      )}

      <View style={{ flex: 1 }} />

      <Button
        mode="outlined"
        onPress={signOut}
        textColor="#C62828"
        style={{ borderColor: '#C62828', borderRadius: 8 }}
      >
        Log Out
      </Button>

      <Text variant="bodySmall" style={{ textAlign: 'center', color: '#ccc', marginTop: 16 }}>
        Powered by OpBros
      </Text>
    </View>
  )
}
```

2. **Replace app/(tabs)/notes.tsx:**

```typescript
import { View } from 'react-native'
import { Text } from 'react-native-paper'
import { MaterialCommunityIcons } from '@expo/vector-icons'

export default function NotesScreen() {
  return (
    <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center', padding: 24, backgroundColor: '#F5F5F5' }}>
      <MaterialCommunityIcons name="note-text-outline" size={48} color="#ccc" />
      <Text variant="titleMedium" style={{ marginTop: 16, color: '#666' }}>
        My Notes
      </Text>
      <Text variant="bodyMedium" style={{ color: '#999', textAlign: 'center', marginTop: 8 }}>
        Your case notes will appear here after you complete shifts.
      </Text>
    </View>
  )
}
```

Key points:
- Profile shows user name (from metadata) and email
- Pending sync count shown if > 0 (amber card)
- Logout button in red outline (destructive action visual)
- "Powered by OpBros" footer (INFR-08 requirement)
- Notes tab is a clean placeholder with icon + helpful text
  </action>
  <verify>Check: `grep "signOut\|OpBros" apps/worker-mobile/app/\(tabs\)/profile.tsx` and `cat apps/worker-mobile/app/\(tabs\)/notes.tsx | head -5`</verify>
  <done>Profile shows worker name, email, pending sync count, and logout button with OpBros footer. Notes tab shows placeholder with helpful message for Phase 6.</done>
</task>

</tasks>

<verification>
- WeeklyCalendar renders 7 columns (Mon-Sun) with day headers
- Shifts appear as colored blocks at correct time positions
- Week navigation arrows change the displayed week
- Profile screen shows user info from session
- Logout button calls signOut and returns to login
- Notes screen shows placeholder text
- Today's column highlighted in calendar
</verification>

<success_criteria>
- Worker can view weekly schedule with shifts as colored time blocks (MOBL-06)
- Week navigation works (previous/next week arrows)
- Tapping a shift block in calendar opens shift detail
- Worker can log out from profile tab (session cleared)
- "Powered by OpBros" visible on profile screen (INFR-08)
</success_criteria>

<output>
After completion, create `.planning/phases/05-worker-mobile-app/05-07-SUMMARY.md`
</output>
